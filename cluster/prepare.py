import pickle
from os import path, makedirs

from cluster.parameters import cl_parameters


def prepare():

    n_positions = 21
    n_prices = 11

    n_firms = 2

    firm_momentum = 0.0  # Only NN
    firm_neural_network = "MLP"  # Only NN

    customer_momentum = 0.0  # Only NN
    customer_neural_network = "MLP"  # Only NN

    t_max = 5000

    firm = "StrategicNeuralNetwork"
    customer = "CustomerSimple"

    range_firm_alpha = [0.01, 0.10]
    range_firm_temp = [0.01, 0.03]
    range_customer_alpha = [0.01, 0.10]
    range_customer_temp = [0.01, 0.03]

    range_transportation_cost = [0.1, 0.5, 1, 1.5, 2]
    utility_consumption = 21  # [n_prices+1, (n_prices*2) + 1]
    range_customer_extra_view = [n for n in range(n_prices)]

    parameters_list = []

    for i in range(cl_parameters["n_jobs"]):

        param = {
            "job_id": i,

            "n_firms": n_firms,

            "firm": firm,
            "customer": customer,

            "n_positions": n_positions,
            "n_prices": n_prices,

            "utility_consumption": utility_consumption,

            "range_transportation_cost": range_transportation_cost,
            "range_firm_temp": range_firm_temp,
            "range_firm_alpha": range_firm_alpha,

            "range_customer_alpha": range_customer_alpha,
            "range_customer_temp": range_customer_temp,
            "range_customer_extra_view": range_customer_extra_view,

            "firm_momentum": firm_momentum,
            "firm_neural_network": firm_neural_network,  # Useful for NN

            "customer_momentum": customer_momentum,
            "customer_neural_network": customer_neural_network,

            "t_max": t_max
        }

        i += 1

        parameters_list.append(param)

    if not path.exists(cl_parameters["working_folder"]):
        makedirs(cl_parameters["working_folder"])

    parameters_file = "{}/cluster_computing_parameters.p".format(cl_parameters["working_folder"])
    with open(parameters_file, "wb") as f:

        pickle.dump(parameters_list, f)
